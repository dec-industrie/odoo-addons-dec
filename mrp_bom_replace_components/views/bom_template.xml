<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="track_bom_line_template">
        <div>
            <strong>Some products have been replaced using replacement wizard.</strong>
            <ul>
                <t t-foreach="lines" t-as="bom_line">
                    <li>On line with sequence <t t-esc="bom_line.sequence"/>:</li>
                    Before: <t t-esc="bom_line_value['before'].display_name" /><br/>
                    After: <t t-esc="bom_line_value['after'].display_name" /><br/>
                </t>
            </ul>
        </div>
    </template>

    <template id="track_bom_template">
        <div>
            <strong>Bill of materials has changed.</strong><br/>
            <small>
                <t t-if="edited_lines">
                    <span>Edited:</span>
                    <table class="note_table">
                        <thead>
                            <tr>
                                <th>Component</th>
                                <th>Field</th>
                                <th>Previous</th>
                                <th>Current</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="edited_lines" t-as="id">
                                <t t-foreach="edited_lines[id]['diffkeys']" t-as="diffkey">
                                    <tr>
                                        <td>
                                            <small><span t-field="edited_lines[id]['line'].sequence"/>:</small>
                                            <span t-field="edited_lines[id]['line'].product_id"/>
                                        </td>
                                        <td>
                                            <t t-esc="tracked_fields[diffkey]"/>
                                        </td>
                                        <td>
                                            <t t-esc="edited_lines[id]['previous'][diffkey]"/>
                                        </td>
                                        <td>
                                            <t t-esc="edited_lines[id]['current'][diffkey]"/>
                                        </td>
                                    </tr>
                                </t>
                            </t>
                        </tbody>
                    </table>
                </t>
                
                <t t-if="added_lines">
                    <span>Added:</span>
                    <table class="note_table">
                        <thead>
                            <tr>
                                <th>
                                    <t t-esc="tracked_fields['product_id']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['partner_id']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['buy_consumable']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['landmark']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['product_qty']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['public_price']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['unit_price']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['cost_price']"/>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="added_lines" t-as="id">
                                <tr>
                                    <td>
                                        <small><span t-field="added_lines[id].sequence"/>:</small>
                                        <span t-field="added_lines[id].product_id"/>
                                    </td>
                                    <td>
                                        <span t-field="added_lines[id].partner_id"/>
                                    </td>
                                    <td>
                                        <t t-if="added_lines[id].buy_consumable">
                                            <i class="fa fa-check-square-o" aria-hidden="true"></i><br/>
                                        </t>
                                        <t t-else="">
                                            <i class="fa fa-square-o" aria-hidden="false"></i><br/>
                                        </t>
                                    </td>
                                    <td>
                                        <span t-field="added_lines[id].landmark"/>
                                    </td>
                                    <td>
                                        <span t-field="added_lines[id].product_qty"/> <span t-field="added_lines[id].product_uom_id"/>
                                    </td>
                                    <td>
                                        <span t-field="added_lines[id].public_price"/>
                                    </td>
                                    <td>
                                        <span t-field="added_lines[id].unit_price"/>
                                    </td>
                                    <td>
                                        <span t-field="added_lines[id].cost_price"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>

                <t t-if="removed_lines">
                    <span>Removed:</span>
                    <table class="note_table">
                        <thead>
                            <tr>
                                <th>
                                    <t t-esc="tracked_fields['product_id']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['partner_id']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['buy_consumable']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['landmark']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['product_qty']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['public_price']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['unit_price']"/>
                                </th>
                                <th>
                                    <t t-esc="tracked_fields['cost_price']"/>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="removed_lines" t-as="id">
                                <tr>
                                    <td>
                                        <t t-esc="removed_lines[id]['product_id']"/>
                                    </td>
                                    <td>
                                        <t t-esc="removed_lines[id]['partner_id']"/>
                                    </td>
                                    <td>
                                        <t t-if="removed_lines[id]['buy_consumable']">
                                            <i class="fa fa-check-square-o" aria-hidden="true"></i><br/>
                                        </t>
                                        <t t-else="">
                                            <i class="fa fa-square-o" aria-hidden="false"></i><br/>
                                        </t>
                                    </td>
                                    <td>
                                        <t t-esc="removed_lines[id]['landmark']"/>
                                    </td>
                                    <td>
                                        <t t-esc="removed_lines[id]['product_qty']"/> <t t-esc="removed_lines[id]['product_uom_id']"/>
                                    </td>
                                    <td>
                                        <t t-esc="removed_lines[id]['public_price']"/>
                                    </td>
                                    <td>
                                        <t t-esc="removed_lines[id]['unit_price']"/>
                                    </td>
                                    <td>
                                        <t t-esc="removed_lines[id]['cost_price']"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>
            </small>
        </div>
    </template>

</odoo>
