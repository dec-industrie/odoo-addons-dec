<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="view_production_calendar" model="ir.ui.view">
            <field name="name">mrp.production.calendar</field>
            <field name="model">mrp.production</field>
            <field name="type">calendar</field>
            <field eval="1" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="assigned_workcenter" date_start="date_planned" string="Manufacturing Orders">
                    <field name="name"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                </calendar>
            </field>
        </record>
        
        
<!--    	<delete model="ir.ui.view" search="[('name','=','mrp.production.gantt')]"/>-->
    	
        <record id="view_production_gantt" model="ir.ui.view" >
            <field name="name">mrp.production.gantt</field>
            <field name="model">mrp.production</field>
            <field name="type">gantt</field>            
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
	        	<gantt date_stop="date_finished" custom_name="view_name" date_start="date_start" string="Productions" day_length="7" default_group_by="assigned_workcenter" />
            </field>
        </record>

        
        <menuitem action="mrp_production_action_dec" id="mrp.menu_mrp_production_action"
            parent="mrp.menu_mrp_manufacturing" sequence="1"/>
        
        <record id="view_mrp_production_filter_dec" model="ir.ui.view">
            <field name="name">mrp.production.select</field>
            <field name="model">mrp.production</field>
            <field name="type">search</field>
			<field name="inherit_id" ref="mrp.view_mrp_production_filter"/>
            <field name="arch" type="xml">
            
             	<xpath expr="/search/group/filter[@name='pending']" position="before">
                       <filter icon="STOCK_NEW" string="New" name="new"
                           domain="[('state','=','draft')]"
                           help="New Manufacturing Orders ready to be validate."/>
             	</xpath>      
                           
             	<xpath expr="/search/group/filter[@string='Late']" position="after">
                       <filter icon="terp-gnome-cpu-frequency-applet+" string="Late (Future)"
                           domain="['&amp;', ('late','=', True), ('state', 'in', ('draft', 'confirmed', 'ready'))]"
                           help="Production will start late as planned" />
             	</xpath>
             	
             	
                <field name="routing_id" position="replace">
                	<field name="assigned_workcenter"/>
                </field>
                
                <field name="origin" position="after">
                	<field name="partner_address_city_id"/>
                </field>
             	
             	<xpath expr="/search/group[2]" position="replace">
             	     <group expand="0" string="Group By..." >
                        <filter string="Product" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'product_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Assigned to" icon="stock_person" domain="[]" context="{'group_by':'assigned_workcenter'}"/>
                        <filter string="Origin" icon="gtk-dnd" domain="[]" context="{'group_by':'origin'}"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_planned'}" help="Scheduled Date"/>
                    </group>
             	</xpath>
             	
            </field>
        </record>
        
        <record id="mrp_production_action_dec" model="ir.actions.act_window">
            <field name="name">Manufacturing Orders (All)</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph,gantt</field>
            <field name="view_id" eval="False"/>
            <field name="search_view_id" ref="view_mrp_production_filter_dec"/>
            <field name="context">{'search_default_new':1,'search_default_ready':1,'search_default_pending':1}</field>
            <field name="help">Manufacturing Orders are usually proposed automatically by OpenERP based on the bill of materials and the procurement rules, but you can also create manufacturing orders manually. OpenERP will handle the consumption of the raw materials (stock decrease) and the production of the finished products (stock increase) when the order is processed.</field>
        </record>


<!--    	<delete model="ir.ui.view" search="[('name','=','mrp.production.tree')]"/>-->
        <record id="mrp_production_tree_view" model="ir.ui.view">
            <field name="name">mrp.production.tree</field>
            <field name="model">mrp.production</field>
            <field name="type">tree</field>
            <field eval="1" name="priority"/>
            <field name="arch" type="xml">
                <tree colors="green:state in ('draft');blue:state in ('confirmed');red:date_planned&lt;current_date and state not in ('done','cancel');gray:state in ('done','cancel');black:date_planned&gt;=current_date" string="Manufacturing Orders">
                    <field name="name"/>
                    <field name="date_planned"/>
                    <field name="product_id"/>
                    <field name="product_qty" sum="Total Qty"/>
                    <field name="product_uom"/>
					<field name="assigned_workcenter"/>
					<field name="picked_rate" widget="progressbar"/>
					<field name="tested_rate" widget="progressbar"/>
                    <field name="hour_total" sum="Total Hours"/>
                    <field name="origin"/>
	                <field name="partner_id"/>
                    <field name="partner_address_city_id"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
		
        <record id="mrp_production_form_view_dec" model="ir.ui.view">
            <field name="name">mrp.production.form</field>
            <field name="model">mrp.production</field>
            <field name="type">form</field>
			<field name="inherit_id" ref="mrp.mrp_production_form_view"/>
            <field name="arch" type="xml">
            
            	<field name="name" position="before">
               		<separator string="Production order" colspan="7"/>
            	</field>
            	
            	<button type="action" name="%(mrp.action_change_production_qty)d" position="replace" />
            	
                <field name="origin" position="replace">
             		<field name="assigned_workcenter" />
                </field>
                            	
                <field name="product_uos" position="after">
            		<newline/>
               		<separator string="Source" colspan="6"/>
                	<field name="origin"/>
                	<field name="sale_requested_date"/>
                	<field name="sale_commitment_date"/>
                	<field name="partner_id"/>
	                <field name="partner_address_id" domain="[('partner_id','=',partner_id)]"/>
	            </field>


             	<xpath expr="/form/notebook/page[@string='Consumed Products']" position="before">		                

                       <page string="Procurement">  
                                    		
		                    <group colspan="4" col="4">
		            		    <field name="bom_id" domain="[('product_id','=',product_id),('bom_id','=',False)]" on_change="bom_id_change(bom_id)"/>
								
								 <group colspan="2" col="6">
									<field name="picked_rate" widget="progressbar"/>
									<field name="tested_rate" widget="progressbar" attrs="{'invisible':[('tested_count','=','0')]}"/>
									<field name="tested_count" nolabel="1"  attrs="{'invisible':[('tested_count','=','0')]}"/>
									<button name="button_create_task" confirm="Please confirm task creation, are you sure ?" string="Create testing task"  states="ready,confirmed,in_production,done" type="object" icon="terp-idea" colspan="1"/>
								</group>
								
		                        <field name="location_src_id" domain="[('usage','=','internal')]" on_change="location_id_change(location_src_id,location_dest_id)"/>
		                        <field name="location_dest_id" domain="[('usage','=','internal')]"/>
			                </group>
			                
	      	            <field colspan="4" name="move_all_src_ids" nolabel="1" widget="one2many_list" mode="tree" height="275" domain="[('state','&lt;&gt;', ('done', 'cancel'))]">
		                    <tree colors="blue:state == 'draft';black:state in ('picking_except','confirmed','ready','in_production');gray:state in ('cancel','done')" string="Moves">
		                        <field name="product_id" />
		                        <field name="product_qty"  string="Qty"/>
		                        <field name="product_uom"  string="UOM"/>
		                        <field name="state"/>
		                        <button name="%(stock.move_consume)d" string="Consume Products" type="action" icon="gtk-go-forward" context="{'consume': True}" states="draft,waiting,confirmed,assigned" />
		                        <field name="status_received"/>
		                        <field name="status_status"/>
		                        <field name="status_dedicated"/>
		                    </tree>
	                    </field>
                       </page>
             	</xpath>
             	
             	<xpath expr="/form/notebook/page[@string='Consumed Products']" position="replace" />
             	
             	<xpath expr="/form/notebook" position="after">
                            <group col="9" colspan="4">
                                <field name="state" widget="statusbar" statusbar_visible="draft,ready,in_production,done" statusbar_colors='{"picking_except":"red","confirmed":"blue"}'/>
                                <button name="button_cancel" states="draft,ready,in_production,picking_except" string="Cancel" icon="gtk-stop"/>
                                <button name="action_cancel" type="object" states="confirmed" string="Cancel" icon="gtk-stop"/>
                                <button name="button_confirm" states="draft" string="Confirm Production" icon="gtk-apply"/>
                                <button name="button_produce" states="ready" string="Start Production" icon="terp-gtk-jump-to-ltr"/>
                                <button name="%(mrp.act_mrp_product_produce)d" states="in_production" string="Produce" icon="gtk-ok" type="action"/>
                                <button name="force_production" states="confirmed,picking_except" string="Force Reservation" type="object" icon="gtk-jump-to"/>
                                <button name="button_recreate" states="picking_except" string="Recreate Picking" icon="terp-document-new"/>
                            </group>
               </xpath>

             	
                <field name="workcenter_lines" position="replace">
					<field colspan="4" name="workcenter_lines" nolabel="1" context="{'production_id':active_id}">
						<form string="Production Work Centers">
							<field colspan="4" name="name"/>
							<field name="workcenter_id" widget="selection"/>
							<field name="sequence"/>
							<field name="working_date"/>
							<field name="hour"/>
						</form>
						<tree string="Production Work Centers">
							<field name="sequence"/>
							<field name="name"/>
							<field name="workcenter_id" widget="selection"/>
							<field name="working_date"/>
							<field name="hour"/>
						</tree>
					</field>
                </field>
            </field>
        </record>
        


    </data>
</openerp>
